<?php	// lets run an ajax request to get all of our field data, to either prepopulate	// or build our default selection arrays etc.	$api_key = get_option( 'yikes-mc-api-key' , '' );	$MailChimp = new MailChimp( $api_key );	// get the interest group data	try {		$interest_groupings = $MailChimp->call( 'lists/interest-groupings' , array( 'apikey' => $api_key , 'id' => $form_data_array['list_id'] ) );		if( $interest_groupings ) {			// find and return the location of this merge field in the array			$index = $this->findMCListIndex( $form_data_array['group_id'] , $interest_groupings , 'id' );			// check for our index...			if( isset( $index) ) {				// store it and use it to pre-populate field data (only on initial add to form)				$merge_field_data = $interest_groupings[$index];			}		}		} catch( Exception $error ) {		$no_interest_groupings = $error->getMessage();	}?><section class="draggable" id="<?php echo $form_data_array['group_id']; ?>">	<!-- top -->	<a href="#" class="expansion-section-title settings-sidebar">		<span class="dashicons dashicons-plus" title="<?php _e( 'Expand Field' , $this->text_domain ); ?>"></span><?php echo $form_data_array['field_name']; ?>		<span style="float:right;"><small><?php echo __( 'type' , $this->text_domain ) . ' : ' . $form_data_array['field_type']; ?></small></span>	</a>	<!-- expansion section -->	<div class="yikes-mc-settings-expansion-section">							<!-- Single or Double Optin -->		<p style="margin-top:0;margin:0;"><!-- necessary to prevent skipping on slideToggle(); -->			<!-- store the label -->			<input type="hidden" name="field[<?php echo $form_data_array['group_id']; ?>][label]" value="<?php echo $form_data_array['field_name']; ?>" />			<input type="hidden" name="field[<?php echo $form_data_array['group_id']; ?>][type]" value="<?php echo $form_data_array['field_type']; ?>" />			<input type="hidden" name="field[<?php echo $form_data_array['group_id']; ?>][group_id]" value="<?php echo $form_data_array['group_id']; ?>" />						<?php if ( $form_data_array['field_type'] == 'radio' || $form_data_array['field_type'] == 'dropdown' || $form_data_array['field_type'] == 'checkboxes' ) { ?>				<input type="hidden" name="field[<?php echo $form_data_array['group_id']; ?>][groups]" value='<?php echo stripslashes( json_encode( $merge_field_data['groups'] ) ); ?>' />			<?php } ?>							<table class="form-table" style="margin-top:0;">							<!-- Default Value -->				<?php switch( $form_data_array['field_type'] ) { 												default:						case 'radio':						?>							<tr valign="top">								<td scope="row">									<label for="placeholder">										<?php _e( 'Default Selection' , $this->text_domain ); ?>									</label>								</td>								<td>									<?php $i = 0; foreach( $merge_field_data['groups'] as $interest_group ) { 											$pre_selected = !empty( $merge_field_data['default_choice'] ) ? $merge_field_data['default_choice'] : '0';									?>										<input type="radio" name="field[<?php echo $form_data_array['group_id']; ?>][default_choice][]" value="<?php echo $i; ?>" <?php checked( $pre_selected , $i ); ?>><?php echo $interest_group['name']; ?>									<?php 										$i++;										} 									?>									<p class="description"><small><?php _e( "Select the option that should be selected by default.", $this->text_domain );?></small></p>								</td>							</tr>																		<?php							break;												case 'checkboxes':						?>							<tr valign="top">								<td scope="row">									<label for="placeholder">										<?php _e( 'Default Selection' , $this->text_domain ); ?>									</label>								</td>								<td>									<?php $i = 0; foreach( $merge_field_data['groups'] as $interest_group ) { 											$pre_selected = !empty( $merge_field_data['default_choice'] ) ? $merge_field_data['default_choice'] : '0';									?>										<input type="checkbox" name="field[<?php echo $form_data_array['group_id']; ?>][default_choice][]" value="<?php echo $i; ?>" <?php checked( $pre_selected , $i ); ?>><?php echo $interest_group['name']; ?>									<?php 										$i++;										} 									?>									<p class="description"><small><?php _e( "Select the option that should be selected by default.", $this->text_domain );?></small></p>								</td>							</tr>																		<?php							break;															case 'dropdown':							?>							<tr valign="top">								<td scope="row">									<label for="placeholder">										<?php _e( 'Default Selection' , $this->text_domain ); ?>									</label>								</td>								<td>									<select type="default" name="field[<?php echo $form_data_array['group_id']; ?>][default_choice]">										<?php $i = 0; foreach( $merge_field_data['groups'] as $interest_group ) { 												$pre_selected = !empty( $merge_field_data['default_choice'] ) ? $merge_field_data['default_choice'] : '0';										?>											<option value="<?php echo $i; ?>" <?php selected( $pre_selected , $i ); ?>><?php echo $interest_group['name']; ?></option>										<?php } ?>									</select>									<p class="description"><small><?php _e( "Which option should be selected by default?", $this->text_domain );?></small></p>								</td>							</tr>															<?php							break;						?>														<?php } // end switch field type ?>								<!-- Field Description -->				<tr valign="top">					<td scope="row">						<label for="placeholder">							<?php _e( 'Description' , $this->text_domain ); ?>						</label>					</td>					<td>						<textarea class="widefat field-description-input" name="field[<?php echo $form_data_array['group_id'] ?>][description]"></textarea>						<p class="description"><small><?php _e( "Enter the description for the form field. This will be displayed to the user and provide some direction on how the field should be filled out or selected.", $this->text_domain );?></small></p>					</td>				</tr>								<!-- Additional Classes -->				<tr valign="top">					<td scope="row">						<label for="placeholder">							<?php _e( 'Additional Classes' , $this->text_domain ); ?>						</label>					</td>					<td>						<input type="text" class="widefat" name="field[<?php echo $form_data_array['group_id']; ?>][additional-classes]" value="<?php echo isset( $form_data_array['classes'] ) ? $form_data_array['classes'] : '' ; ?>" />						<p class="description"><small><?php _e( "Assign additional classes to this field.", $this->text_domain );?></small></p>					</td>					</tr>					<!-- Required Toggle -->					<tr valign="top">						<td scope="row">							<label for="field-required">								<?php _e( 'Field Required?' , $this->text_domain ); ?>							</label>						</td>						<td>							<input type="checkbox" class="widefat" value="1" name="field[<?php echo $form_data_array['group_id']; ?>][require]">							<p class="description"><small><?php _e( "Require this field to be filled in before the form can be submitted.", $this->text_domain );?></small></p>						</td>					</tr>					<!-- Visible Toggle -->					<tr valign="top">						<td scope="row">							<label for="hide-field">								<?php _e( 'Hide Field' , $this->text_domain ); ?>							</label>						</td>						<td>							<input type="checkbox" class="widefat" value="1" name="field[<?php echo $form_data_array['group_id']; ?>][hide]">							<p class="description"><small><?php _e( "Hide this field from being displayed on the front end.", $this->text_domain );?></small></p>						</td>					</tr>					<!-- Toggle Field Label Visibility -->					<tr valign="top">						<td scope="row">							<label for="placeholder">								<?php _e( 'Hide Label' , $this->text_domain ); ?>							</label>						</td>						<td>							<input type="checkbox" name="field[<?php echo $form_data_array['group_id'] ?>][hide-label]" value="1" />							<p class="description"><small><?php _e( "Toggle field label visibility.", $this->text_domain );?></small></p>						</td>					</tr>					<!-- Toggle Buttons -->					<tr valign="top">						<td scope="row">							&nbsp;						</td>						<td>							<span style="font-size:small;float:right;">								<a href="#" class="hide-field"><?php _e( "Close" , $this->text_domain ); ?></a> |								<a href="#" class="remove-field" alt="<?php echo $form_data_array['group_id']; ?>"><?php _e( "Remove Field" , $this->text_domain ); ?></a>							</span>						</td>					</tr>			</table>		</p>															</div></section>